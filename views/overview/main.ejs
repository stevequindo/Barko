<%- include("../partials/company-header") -%>

<%- include('../modals/success') %>

<div class='container-fluid main-content'>

    <% if (type == 'country') { %>
        <div class='row no-gutters d-flex align-content-start my-3'>
        <% contentArray.forEach((item,index) => { %>
            <% let lowName = item.lowName%>
            <% item.subtitle = item.freightCount %>
            <% item.imgUrl = item.flagUrl %>
            <% item.link = link + '?id=' + lowName %>
            <%- include('container', {contentItem:item}) %>
            <% if ((index + 1) % 4 == 0) { %>
                </div>
                <div class='row no-gutters d-flex align-content-start my-3'>
            <% } %>
        <% }); %>
        </div>
    <% } else if (type == 'manifest') { %>
        <div class='row no-gutters d-flex align-content-start my-3'>
        <% contentArray.forEach((item,index) => { %>
            <% let manifestId = item.manifestId%>
            <% item.subtitle = item.date %>
            <% item.content = item.transaction%>
            <% item.link = link + '&comp=' + manifestId %>
            <%- include('container-manifest', {contentItem: item}) %>
            <% if ((index + 1) % 4 == 0) { %>
                </div>
                <div class='row no-gutters d-flex align-content-start my-3'>
            <% } %>
        <% }); %>
        </div>
    <% } else { %>
        <table class="table table-striped thead-dark table-bordered" id="comm-table">
            <thead>
            <tr>
                <th>Batch No.</th>
                <th>Tracking No.</th>
                <th>Count</th>
                <th>Area</th>
                <th>Sender Name</th>
                <th>Receiver Name</th>
                <th>Status</th>
                <th>Comments</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    <% } %>
</div>

<script>
$(document).ready(function() {
	// Initialise editor
	let editor = new $.fn.dataTable.Editor({
		table: '#comm-table',
		idSrc: "_id",
        // serverSide: true,
		fields: [ {
			label: "Status:",
			name: "status"
		}, {
			label: "Additional Comments: ",
            name: "comment"
        }],
        ajax: {
            edit: {
            	type: 'POST',
                url: '/overview',
				contentType: 'application/json',
                data: (d) => {
            		d = d.data;
            		const jsonData = JSON.stringify(d);
            		console.log(jsonData);
            		return jsonData;
                }
            }
        }
	});

	// Initialise data table
	let table = $('#comm-table').DataTable({
		dom: 'lBfrtip',
		buttons: [
		    'copy',
			{ extend: "edit",   editor: editor },
            'pdf',
	    ],
		paginate: true,
		processing: true,
		select: true,
		stateSave: true,
		"data":<%- contentArray %>,
		"columns": [
			{"data": "batchNo"},
			{"data": "trackingNumber"},
			{"data": "count"},
			{"data": "area"},
			{
				"data": null,
				render: function (data, type, row) {
					let firstName = row.sender_link.firstName;
					let lastName = row.sender_link.lastName;
					return firstName != undefined ? `${firstName} ${lastName}` : "<i>Not provided</i>";
				}
			},
			{
				"data": "receiver_link.firstName",
				render: function (data, type, row) {
					let firstName = row.receiver_link.firstName;
					let lastName = row.receiver_link.lastName;
					return firstName != undefined ? `${firstName} ${lastName}` : "<i>Not provided</i>";
				}
			},
			{"data": "status"},
			{"data": "comment"}
		],

	});
});
</script>
<%- include("../partials/footer") -%>



